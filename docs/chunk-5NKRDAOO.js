import{b as ke,c as tt}from"./chunk-JENGY3ED.js";import{d as u}from"./chunk-PYQTE2ZK.js";var rt=n=>{let t;return n?t=n:typeof fetch>"u"?t=(...e)=>import("./chunk-2UTJ4IR6.js").then(({default:r})=>r(...e)):t=fetch,(...e)=>t(...e)};var se=class extends Error{constructor(t,e="FunctionsError",r){super(t),this.name=e,this.context=r}},xe=class extends se{constructor(t){super("Failed to send a request to the Edge Function","FunctionsFetchError",t)}},Se=class extends se{constructor(t){super("Relay Error invoking the Edge Function","FunctionsRelayError",t)}},Te=class extends se{constructor(t){super("Edge Function returned a non-2xx status code","FunctionsHttpError",t)}};var Dt=function(n,t,e,r){function s(i){return i instanceof e?i:new e(function(o){o(i)})}return new(e||(e=Promise))(function(i,o){function a(h){try{l(r.next(h))}catch(d){o(d)}}function c(h){try{l(r.throw(h))}catch(d){o(d)}}function l(h){h.done?i(h.value):s(h.value).then(a,c)}l((r=r.apply(n,t||[])).next())})},ie=class{constructor(t,{headers:e={},customFetch:r}={}){this.url=t,this.headers=e,this.fetch=rt(r)}setAuth(t){this.headers.Authorization=`Bearer ${t}`}invoke(t,e={}){var r;return Dt(this,void 0,void 0,function*(){try{let{headers:s,method:i,body:o}=e,a={},c;o&&(s&&!Object.prototype.hasOwnProperty.call(s,"Content-Type")||!s)&&(typeof Blob<"u"&&o instanceof Blob||o instanceof ArrayBuffer?(a["Content-Type"]="application/octet-stream",c=o):typeof o=="string"?(a["Content-Type"]="text/plain",c=o):typeof FormData<"u"&&o instanceof FormData?c=o:(a["Content-Type"]="application/json",c=JSON.stringify(o)));let l=yield this.fetch(`${this.url}/${t}`,{method:i||"POST",headers:Object.assign(Object.assign(Object.assign({},a),this.headers),s),body:c}).catch(f=>{throw new xe(f)}),h=l.headers.get("x-relay-error");if(h&&h==="true")throw new Se(l);if(!l.ok)throw new Te(l);let d=((r=l.headers.get("Content-Type"))!==null&&r!==void 0?r:"text/plain").split(";")[0].trim(),p;return d==="application/json"?p=yield l.json():d==="application/octet-stream"?p=yield l.blob():d==="multipart/form-data"?p=yield l.formData():p=yield l.text(),{data:p,error:null}}catch(s){return{data:null,error:s}}})}};var ne=class{constructor(t){this.shouldThrowOnError=!1,this.method=t.method,this.url=t.url,this.headers=t.headers,this.schema=t.schema,this.body=t.body,this.shouldThrowOnError=t.shouldThrowOnError,this.signal=t.signal,this.isMaybeSingle=t.isMaybeSingle,t.fetch?this.fetch=t.fetch:typeof fetch>"u"?this.fetch=ke:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}then(t,e){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),this.method!=="GET"&&this.method!=="HEAD"&&(this.headers["Content-Type"]="application/json");let r=this.fetch,s=r(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(i=>u(this,null,function*(){var o,a,c;let l=null,h=null,d=null,p=i.status,f=i.statusText;if(i.ok){if(this.method!=="HEAD"){let k=yield i.text();k===""||(this.headers.Accept==="text/csv"||this.headers.Accept&&this.headers.Accept.includes("application/vnd.pgrst.plan+text")?h=k:h=JSON.parse(k))}let g=(o=this.headers.Prefer)===null||o===void 0?void 0:o.match(/count=(exact|planned|estimated)/),m=(a=i.headers.get("content-range"))===null||a===void 0?void 0:a.split("/");g&&m&&m.length>1&&(d=parseInt(m[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(h)&&(h.length>1?(l={code:"PGRST116",details:`Results contain ${h.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},h=null,d=null,p=406,f="Not Acceptable"):h.length===1?h=h[0]:h=null)}else{let g=yield i.text();try{l=JSON.parse(g),Array.isArray(l)&&i.status===404&&(h=[],l=null,p=200,f="OK")}catch{i.status===404&&g===""?(p=204,f="No Content"):l={message:g}}if(l&&this.isMaybeSingle&&(!((c=l?.details)===null||c===void 0)&&c.includes("0 rows"))&&(l=null,p=200,f="OK"),l&&this.shouldThrowOnError)throw l}return{error:l,data:h,count:d,status:p,statusText:f}}));return this.shouldThrowOnError||(s=s.catch(i=>{var o,a,c;return{error:{message:`${(o=i?.name)!==null&&o!==void 0?o:"FetchError"}: ${i?.message}`,details:`${(a=i?.stack)!==null&&a!==void 0?a:""}`,hint:"",code:`${(c=i?.code)!==null&&c!==void 0?c:""}`},data:null,count:null,status:0,statusText:""}})),s.then(t,e)}};var oe=class extends ne{select(t){let e=!1,r=(t??"*").split("").map(s=>/\s/.test(s)&&!e?"":(s==='"'&&(e=!e),s)).join("");return this.url.searchParams.set("select",r),this.headers.Prefer&&(this.headers.Prefer+=","),this.headers.Prefer+="return=representation",this}order(t,{ascending:e=!0,nullsFirst:r,foreignTable:s,referencedTable:i=s}={}){let o=i?`${i}.order`:"order",a=this.url.searchParams.get(o);return this.url.searchParams.set(o,`${a?`${a},`:""}${t}.${e?"asc":"desc"}${r===void 0?"":r?".nullsfirst":".nullslast"}`),this}limit(t,{foreignTable:e,referencedTable:r=e}={}){let s=typeof r>"u"?"limit":`${r}.limit`;return this.url.searchParams.set(s,`${t}`),this}range(t,e,{foreignTable:r,referencedTable:s=r}={}){let i=typeof s>"u"?"offset":`${s}.offset`,o=typeof s>"u"?"limit":`${s}.limit`;return this.url.searchParams.set(i,`${t}`),this.url.searchParams.set(o,`${e-t+1}`),this}abortSignal(t){return this.signal=t,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){return this.method==="GET"?this.headers.Accept="application/json":this.headers.Accept="application/vnd.pgrst.object+json",this.isMaybeSingle=!0,this}csv(){return this.headers.Accept="text/csv",this}geojson(){return this.headers.Accept="application/geo+json",this}explain({analyze:t=!1,verbose:e=!1,settings:r=!1,buffers:s=!1,wal:i=!1,format:o="text"}={}){var a;let c=[t?"analyze":null,e?"verbose":null,r?"settings":null,s?"buffers":null,i?"wal":null].filter(Boolean).join("|"),l=(a=this.headers.Accept)!==null&&a!==void 0?a:"application/json";return this.headers.Accept=`application/vnd.pgrst.plan+${o}; for="${l}"; options=${c};`,o==="json"?this:this}rollback(){var t;return((t=this.headers.Prefer)!==null&&t!==void 0?t:"").trim().length>0?this.headers.Prefer+=",tx=rollback":this.headers.Prefer="tx=rollback",this}returns(){return this}};var R=class extends oe{eq(t,e){return this.url.searchParams.append(t,`eq.${e}`),this}neq(t,e){return this.url.searchParams.append(t,`neq.${e}`),this}gt(t,e){return this.url.searchParams.append(t,`gt.${e}`),this}gte(t,e){return this.url.searchParams.append(t,`gte.${e}`),this}lt(t,e){return this.url.searchParams.append(t,`lt.${e}`),this}lte(t,e){return this.url.searchParams.append(t,`lte.${e}`),this}like(t,e){return this.url.searchParams.append(t,`like.${e}`),this}likeAllOf(t,e){return this.url.searchParams.append(t,`like(all).{${e.join(",")}}`),this}likeAnyOf(t,e){return this.url.searchParams.append(t,`like(any).{${e.join(",")}}`),this}ilike(t,e){return this.url.searchParams.append(t,`ilike.${e}`),this}ilikeAllOf(t,e){return this.url.searchParams.append(t,`ilike(all).{${e.join(",")}}`),this}ilikeAnyOf(t,e){return this.url.searchParams.append(t,`ilike(any).{${e.join(",")}}`),this}is(t,e){return this.url.searchParams.append(t,`is.${e}`),this}in(t,e){let r=e.map(s=>typeof s=="string"&&new RegExp("[,()]").test(s)?`"${s}"`:`${s}`).join(",");return this.url.searchParams.append(t,`in.(${r})`),this}contains(t,e){return typeof e=="string"?this.url.searchParams.append(t,`cs.${e}`):Array.isArray(e)?this.url.searchParams.append(t,`cs.{${e.join(",")}}`):this.url.searchParams.append(t,`cs.${JSON.stringify(e)}`),this}containedBy(t,e){return typeof e=="string"?this.url.searchParams.append(t,`cd.${e}`):Array.isArray(e)?this.url.searchParams.append(t,`cd.{${e.join(",")}}`):this.url.searchParams.append(t,`cd.${JSON.stringify(e)}`),this}rangeGt(t,e){return this.url.searchParams.append(t,`sr.${e}`),this}rangeGte(t,e){return this.url.searchParams.append(t,`nxl.${e}`),this}rangeLt(t,e){return this.url.searchParams.append(t,`sl.${e}`),this}rangeLte(t,e){return this.url.searchParams.append(t,`nxr.${e}`),this}rangeAdjacent(t,e){return this.url.searchParams.append(t,`adj.${e}`),this}overlaps(t,e){return typeof e=="string"?this.url.searchParams.append(t,`ov.${e}`):this.url.searchParams.append(t,`ov.{${e.join(",")}}`),this}textSearch(t,e,{config:r,type:s}={}){let i="";s==="plain"?i="pl":s==="phrase"?i="ph":s==="websearch"&&(i="w");let o=r===void 0?"":`(${r})`;return this.url.searchParams.append(t,`${i}fts${o}.${e}`),this}match(t){return Object.entries(t).forEach(([e,r])=>{this.url.searchParams.append(e,`eq.${r}`)}),this}not(t,e,r){return this.url.searchParams.append(t,`not.${e}.${r}`),this}or(t,{foreignTable:e,referencedTable:r=e}={}){let s=r?`${r}.or`:"or";return this.url.searchParams.append(s,`(${t})`),this}filter(t,e,r){return this.url.searchParams.append(t,`${e}.${r}`),this}};var ae=class{constructor(t,{headers:e={},schema:r,fetch:s}){this.url=t,this.headers=e,this.schema=r,this.fetch=s}select(t,{head:e=!1,count:r}={}){let s=e?"HEAD":"GET",i=!1,o=(t??"*").split("").map(a=>/\s/.test(a)&&!i?"":(a==='"'&&(i=!i),a)).join("");return this.url.searchParams.set("select",o),r&&(this.headers.Prefer=`count=${r}`),new R({method:s,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}insert(t,{count:e,defaultToNull:r=!0}={}){let s="POST",i=[];if(this.headers.Prefer&&i.push(this.headers.Prefer),e&&i.push(`count=${e}`),r||i.push("missing=default"),this.headers.Prefer=i.join(","),Array.isArray(t)){let o=t.reduce((a,c)=>a.concat(Object.keys(c)),[]);if(o.length>0){let a=[...new Set(o)].map(c=>`"${c}"`);this.url.searchParams.set("columns",a.join(","))}}return new R({method:s,url:this.url,headers:this.headers,schema:this.schema,body:t,fetch:this.fetch,allowEmpty:!1})}upsert(t,{onConflict:e,ignoreDuplicates:r=!1,count:s,defaultToNull:i=!0}={}){let o="POST",a=[`resolution=${r?"ignore":"merge"}-duplicates`];if(e!==void 0&&this.url.searchParams.set("on_conflict",e),this.headers.Prefer&&a.push(this.headers.Prefer),s&&a.push(`count=${s}`),i||a.push("missing=default"),this.headers.Prefer=a.join(","),Array.isArray(t)){let c=t.reduce((l,h)=>l.concat(Object.keys(h)),[]);if(c.length>0){let l=[...new Set(c)].map(h=>`"${h}"`);this.url.searchParams.set("columns",l.join(","))}}return new R({method:o,url:this.url,headers:this.headers,schema:this.schema,body:t,fetch:this.fetch,allowEmpty:!1})}update(t,{count:e}={}){let r="PATCH",s=[];return this.headers.Prefer&&s.push(this.headers.Prefer),e&&s.push(`count=${e}`),this.headers.Prefer=s.join(","),new R({method:r,url:this.url,headers:this.headers,schema:this.schema,body:t,fetch:this.fetch,allowEmpty:!1})}delete({count:t}={}){let e="DELETE",r=[];return t&&r.push(`count=${t}`),this.headers.Prefer&&r.unshift(this.headers.Prefer),this.headers.Prefer=r.join(","),new R({method:e,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}};var st="1.9.1";var it={"X-Client-Info":`postgrest-js/${st}`};var ce=class n{constructor(t,{headers:e={},schema:r,fetch:s}={}){this.url=t,this.headers=Object.assign(Object.assign({},it),e),this.schemaName=r,this.fetch=s}from(t){let e=new URL(`${this.url}/${t}`);return new ae(e,{headers:Object.assign({},this.headers),schema:this.schemaName,fetch:this.fetch})}schema(t){return new n(this.url,{headers:this.headers,schema:t,fetch:this.fetch})}rpc(t,e={},{head:r=!1,count:s}={}){let i,o=new URL(`${this.url}/rpc/${t}`),a;r?(i="HEAD",Object.entries(e).forEach(([l,h])=>{o.searchParams.append(l,`${h}`)})):(i="POST",a=e);let c=Object.assign({},this.headers);return s&&(c.Prefer=`count=${s}`),new R({method:i,url:o,headers:c,schema:this.schemaName,body:a,fetch:this.fetch,allowEmpty:!1})}};var nt="2.9.1";var ot={"X-Client-Info":`realtime-js/${nt}`},at="1.0.0",Ee=1e4,ct=1e3,G=function(n){return n[n.connecting=0]="connecting",n[n.open=1]="open",n[n.closing=2]="closing",n[n.closed=3]="closed",n}(G||{}),S=function(n){return n.closed="closed",n.errored="errored",n.joined="joined",n.joining="joining",n.leaving="leaving",n}(S||{}),T=function(n){return n.close="phx_close",n.error="phx_error",n.join="phx_join",n.reply="phx_reply",n.leave="phx_leave",n.access_token="access_token",n}(T||{}),He=function(n){return n.websocket="websocket",n}(He||{}),N=function(n){return n.Connecting="connecting",n.Open="open",n.Closing="closing",n.Closed="closed",n}(N||{});var K=class{constructor(t,e){this.callback=t,this.timerCalc=e,this.timer=void 0,this.tries=0,this.callback=t,this.timerCalc=e}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}};var Oe=class{constructor(){this.HEADER_LENGTH=1}decode(t,e){return t.constructor===ArrayBuffer?e(this._binaryDecode(t)):e(typeof t=="string"?JSON.parse(t):{})}_binaryDecode(t){let e=new DataView(t),r=new TextDecoder;return this._decodeBroadcast(t,e,r)}_decodeBroadcast(t,e,r){let s=e.getUint8(1),i=e.getUint8(2),o=this.HEADER_LENGTH+2,a=r.decode(t.slice(o,o+s));o=o+s;let c=r.decode(t.slice(o,o+i));o=o+i;let l=JSON.parse(r.decode(t.slice(o,t.byteLength)));return{ref:null,topic:a,event:c,payload:l}}};var V=class{constructor(t,e,r={},s=Ee){this.channel=t,this.event=e,this.payload=r,this.timeout=s,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(t){this.timeout=t,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(t){this.payload=Object.assign(Object.assign({},this.payload),t)}receive(t,e){var r;return this._hasReceived(t)&&e((r=this.receivedResp)===null||r===void 0?void 0:r.response),this.recHooks.push({status:t,callback:e}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);let t=e=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=e,this._matchReceive(e)};this.channel._on(this.refEvent,{},t),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(t,e){this.refEvent&&this.channel._trigger(this.refEvent,{status:t,response:e})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:t,response:e}){this.recHooks.filter(r=>r.status===t).forEach(r=>r.callback(e))}_hasReceived(t){return this.receivedResp&&this.receivedResp.status===t}};var le=class n{constructor(t,e){this.channel=t,this.state={},this.pendingDiffs=[],this.joinRef=null,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};let r=e?.events||{state:"presence_state",diff:"presence_diff"};this.channel._on(r.state,{},s=>{let{onJoin:i,onLeave:o,onSync:a}=this.caller;this.joinRef=this.channel._joinRef(),this.state=n.syncState(this.state,s,i,o),this.pendingDiffs.forEach(c=>{this.state=n.syncDiff(this.state,c,i,o)}),this.pendingDiffs=[],a()}),this.channel._on(r.diff,{},s=>{let{onJoin:i,onLeave:o,onSync:a}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(s):(this.state=n.syncDiff(this.state,s,i,o),a())}),this.onJoin((s,i,o)=>{this.channel._trigger("presence",{event:"join",key:s,currentPresences:i,newPresences:o})}),this.onLeave((s,i,o)=>{this.channel._trigger("presence",{event:"leave",key:s,currentPresences:i,leftPresences:o})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(t,e,r,s){let i=this.cloneDeep(t),o=this.transformState(e),a={},c={};return this.map(i,(l,h)=>{o[l]||(c[l]=h)}),this.map(o,(l,h)=>{let d=i[l];if(d){let p=h.map(m=>m.presence_ref),f=d.map(m=>m.presence_ref),y=h.filter(m=>f.indexOf(m.presence_ref)<0),g=d.filter(m=>p.indexOf(m.presence_ref)<0);y.length>0&&(a[l]=y),g.length>0&&(c[l]=g)}else a[l]=h}),this.syncDiff(i,{joins:a,leaves:c},r,s)}static syncDiff(t,e,r,s){let{joins:i,leaves:o}={joins:this.transformState(e.joins),leaves:this.transformState(e.leaves)};return r||(r=()=>{}),s||(s=()=>{}),this.map(i,(a,c)=>{var l;let h=(l=t[a])!==null&&l!==void 0?l:[];if(t[a]=this.cloneDeep(c),h.length>0){let d=t[a].map(f=>f.presence_ref),p=h.filter(f=>d.indexOf(f.presence_ref)<0);t[a].unshift(...p)}r(a,h,c)}),this.map(o,(a,c)=>{let l=t[a];if(!l)return;let h=c.map(d=>d.presence_ref);l=l.filter(d=>h.indexOf(d.presence_ref)<0),t[a]=l,s(a,l,c),l.length===0&&delete t[a]}),t}static map(t,e){return Object.getOwnPropertyNames(t).map(r=>e(r,t[r]))}static transformState(t){return t=this.cloneDeep(t),Object.getOwnPropertyNames(t).reduce((e,r)=>{let s=t[r];return"metas"in s?e[r]=s.metas.map(i=>(i.presence_ref=i.phx_ref,delete i.phx_ref,delete i.phx_ref_prev,i)):e[r]=s,e},{})}static cloneDeep(t){return JSON.parse(JSON.stringify(t))}onJoin(t){this.caller.onJoin=t}onLeave(t){this.caller.onLeave=t}onSync(t){this.caller.onSync=t}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}};var w=function(n){return n.abstime="abstime",n.bool="bool",n.date="date",n.daterange="daterange",n.float4="float4",n.float8="float8",n.int2="int2",n.int4="int4",n.int4range="int4range",n.int8="int8",n.int8range="int8range",n.json="json",n.jsonb="jsonb",n.money="money",n.numeric="numeric",n.oid="oid",n.reltime="reltime",n.text="text",n.time="time",n.timestamp="timestamp",n.timestamptz="timestamptz",n.timetz="timetz",n.tsrange="tsrange",n.tstzrange="tstzrange",n}(w||{}),Ke=(n,t,e={})=>{var r;let s=(r=e.skipTypes)!==null&&r!==void 0?r:[];return Object.keys(t).reduce((i,o)=>(i[o]=Ft(o,n,t,s),i),{})},Ft=(n,t,e,r)=>{let s=t.find(a=>a.name===n),i=s?.type,o=e[n];return i&&!r.includes(i)?lt(i,o):Ge(o)},lt=(n,t)=>{if(n.charAt(0)==="_"){let e=n.slice(1,n.length);return Jt(t,e)}switch(n){case w.bool:return Nt(t);case w.float4:case w.float8:case w.int2:case w.int4:case w.int8:case w.numeric:case w.oid:return qt(t);case w.json:case w.jsonb:return Mt(t);case w.timestamp:return Bt(t);case w.abstime:case w.date:case w.daterange:case w.int4range:case w.int8range:case w.money:case w.reltime:case w.text:case w.time:case w.timestamptz:case w.timetz:case w.tsrange:case w.tstzrange:return Ge(t);default:return Ge(t)}},Ge=n=>n,Nt=n=>{switch(n){case"t":return!0;case"f":return!1;default:return n}},qt=n=>{if(typeof n=="string"){let t=parseFloat(n);if(!Number.isNaN(t))return t}return n},Mt=n=>{if(typeof n=="string")try{return JSON.parse(n)}catch(t){return console.log(`JSON parse error: ${t}`),n}return n},Jt=(n,t)=>{if(typeof n!="string")return n;let e=n.length-1,r=n[e];if(n[0]==="{"&&r==="}"){let i,o=n.slice(1,e);try{i=JSON.parse("["+o+"]")}catch{i=o?o.split(","):[]}return i.map(a=>lt(t,a))}return n},Bt=n=>typeof n=="string"?n.replace(" ","T"):n;var he=class n{constructor(t,e={config:{}},r){this.topic=t,this.params=e,this.socket=r,this.bindings={},this.state=S.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=t.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:""}},e.config),this.timeout=this.socket.timeout,this.joinPush=new V(this,T.join,this.params,this.timeout),this.rejoinTimer=new K(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=S.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(s=>s.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=S.closed,this.socket._remove(this)}),this._onError(s=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,s),this.state=S.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=S.errored,this.rejoinTimer.scheduleTimeout())}),this._on(T.reply,{},(s,i)=>{this._trigger(this._replyEventName(i),s)}),this.presence=new le(this),this.broadcastEndpointURL=this._broadcastEndpointURL()}subscribe(t,e=this.timeout){var r,s;if(this.socket.isConnected()||this.socket.connect(),this.joinedOnce)throw"tried to subscribe multiple times. 'subscribe' can only be called a single time per channel instance";{let{config:{broadcast:i,presence:o}}=this.params;this._onError(l=>t&&t("CHANNEL_ERROR",l)),this._onClose(()=>t&&t("CLOSED"));let a={},c={broadcast:i,presence:o,postgres_changes:(s=(r=this.bindings.postgres_changes)===null||r===void 0?void 0:r.map(l=>l.filter))!==null&&s!==void 0?s:[]};this.socket.accessToken&&(a.access_token=this.socket.accessToken),this.updateJoinPayload(Object.assign({config:c},a)),this.joinedOnce=!0,this._rejoin(e),this.joinPush.receive("ok",({postgres_changes:l})=>{var h;if(this.socket.accessToken&&this.socket.setAuth(this.socket.accessToken),l===void 0){t&&t("SUBSCRIBED");return}else{let d=this.bindings.postgres_changes,p=(h=d?.length)!==null&&h!==void 0?h:0,f=[];for(let y=0;y<p;y++){let g=d[y],{filter:{event:m,schema:k,table:A,filter:P}}=g,x=l&&l[y];if(x&&x.event===m&&x.schema===k&&x.table===A&&x.filter===P)f.push(Object.assign(Object.assign({},g),{id:x.id}));else{this.unsubscribe(),t&&t("CHANNEL_ERROR",new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=f,t&&t("SUBSCRIBED");return}}).receive("error",l=>{t&&t("CHANNEL_ERROR",new Error(JSON.stringify(Object.values(l).join(", ")||"error")))}).receive("timeout",()=>{t&&t("TIMED_OUT")})}return this}presenceState(){return this.presence.state}track(r){return u(this,arguments,function*(t,e={}){return yield this.send({type:"presence",event:"track",payload:t},e.timeout||this.timeout)})}untrack(){return u(this,arguments,function*(t={}){return yield this.send({type:"presence",event:"untrack"},t)})}on(t,e,r){return this._on(t,e,r)}send(r){return u(this,arguments,function*(t,e={}){var s,i;if(!this._canPush()&&t.type==="broadcast"){let{event:o,payload:a}=t,c={method:"POST",headers:{apikey:(s=this.socket.accessToken)!==null&&s!==void 0?s:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:o,payload:a}]})};try{return(yield this._fetchWithTimeout(this.broadcastEndpointURL,c,(i=e.timeout)!==null&&i!==void 0?i:this.timeout)).ok?"ok":"error"}catch(l){return l.name==="AbortError"?"timed out":"error"}}else return new Promise(o=>{var a,c,l;let h=this._push(t.type,t,e.timeout||this.timeout);t.type==="broadcast"&&!(!((l=(c=(a=this.params)===null||a===void 0?void 0:a.config)===null||c===void 0?void 0:c.broadcast)===null||l===void 0)&&l.ack)&&o("ok"),h.receive("ok",()=>o("ok")),h.receive("timeout",()=>o("timed out"))})})}updateJoinPayload(t){this.joinPush.updatePayload(t)}unsubscribe(t=this.timeout){this.state=S.leaving;let e=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(T.close,"leave",this._joinRef())};return this.rejoinTimer.reset(),this.joinPush.destroy(),new Promise(r=>{let s=new V(this,T.leave,{},t);s.receive("ok",()=>{e(),r("ok")}).receive("timeout",()=>{e(),r("timed out")}).receive("error",()=>{r("error")}),s.send(),this._canPush()||s.trigger("ok",{})})}_broadcastEndpointURL(){let t=this.socket.endPoint;return t=t.replace(/^ws/i,"http"),t=t.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),t.replace(/\/+$/,"")+"/api/broadcast"}_fetchWithTimeout(t,e,r){return u(this,null,function*(){let s=new AbortController,i=setTimeout(()=>s.abort(),r),o=yield this.socket.fetch(t,Object.assign(Object.assign({},e),{signal:s.signal}));return clearTimeout(i),o})}_push(t,e,r=this.timeout){if(!this.joinedOnce)throw`tried to push '${t}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let s=new V(this,t,e,r);return this._canPush()?s.send():(s.startTimeout(),this.pushBuffer.push(s)),s}_onMessage(t,e,r){return e}_isMember(t){return this.topic===t}_joinRef(){return this.joinPush.ref}_trigger(t,e,r){var s,i;let o=t.toLocaleLowerCase(),{close:a,error:c,leave:l,join:h}=T;if(r&&[a,c,l,h].indexOf(o)>=0&&r!==this._joinRef())return;let p=this._onMessage(o,e,r);if(e&&!p)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(o)?(s=this.bindings.postgres_changes)===null||s===void 0||s.filter(f=>{var y,g,m;return((y=f.filter)===null||y===void 0?void 0:y.event)==="*"||((m=(g=f.filter)===null||g===void 0?void 0:g.event)===null||m===void 0?void 0:m.toLocaleLowerCase())===o}).map(f=>f.callback(p,r)):(i=this.bindings[o])===null||i===void 0||i.filter(f=>{var y,g,m,k,A,P;if(["broadcast","presence","postgres_changes"].includes(o))if("id"in f){let x=f.id,F=(y=f.filter)===null||y===void 0?void 0:y.event;return x&&((g=e.ids)===null||g===void 0?void 0:g.includes(x))&&(F==="*"||F?.toLocaleLowerCase()===((m=e.data)===null||m===void 0?void 0:m.type.toLocaleLowerCase()))}else{let x=(A=(k=f?.filter)===null||k===void 0?void 0:k.event)===null||A===void 0?void 0:A.toLocaleLowerCase();return x==="*"||x===((P=e?.event)===null||P===void 0?void 0:P.toLocaleLowerCase())}else return f.type.toLocaleLowerCase()===o}).map(f=>{if(typeof p=="object"&&"ids"in p){let y=p.data,{schema:g,table:m,commit_timestamp:k,type:A,errors:P}=y;p=Object.assign(Object.assign({},{schema:g,table:m,commit_timestamp:k,eventType:A,new:{},old:{},errors:P}),this._getPayloadRecords(y))}f.callback(p,r)})}_isClosed(){return this.state===S.closed}_isJoined(){return this.state===S.joined}_isJoining(){return this.state===S.joining}_isLeaving(){return this.state===S.leaving}_replyEventName(t){return`chan_reply_${t}`}_on(t,e,r){let s=t.toLocaleLowerCase(),i={type:s,filter:e,callback:r};return this.bindings[s]?this.bindings[s].push(i):this.bindings[s]=[i],this}_off(t,e){let r=t.toLocaleLowerCase();return this.bindings[r]=this.bindings[r].filter(s=>{var i;return!(((i=s.type)===null||i===void 0?void 0:i.toLocaleLowerCase())===r&&n.isEqual(s.filter,e))}),this}static isEqual(t,e){if(Object.keys(t).length!==Object.keys(e).length)return!1;for(let r in t)if(t[r]!==e[r])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(t){this._on(T.close,{},t)}_onError(t){this._on(T.error,{},e=>t(e))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(t=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=S.joining,this.joinPush.resend(t))}_getPayloadRecords(t){let e={new:{},old:{}};return(t.type==="INSERT"||t.type==="UPDATE")&&(e.new=Ke(t.columns,t.record)),(t.type==="UPDATE"||t.type==="DELETE")&&(e.old=Ke(t.columns,t.old_record)),e}};var Ht=()=>{},Gt=typeof WebSocket<"u",ue=class{constructor(t,e){var r;this.accessToken=null,this.channels=[],this.endPoint="",this.headers=ot,this.params={},this.timeout=Ee,this.heartbeatIntervalMs=3e4,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.ref=0,this.logger=Ht,this.conn=null,this.sendBuffer=[],this.serializer=new Oe,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this._resolveFetch=i=>{let o;return i?o=i:typeof fetch>"u"?o=(...a)=>import("./chunk-2UTJ4IR6.js").then(({default:c})=>c(...a)):o=fetch,(...a)=>o(...a)},this.endPoint=`${t}/${He.websocket}`,e?.transport?this.transport=e.transport:this.transport=null,e?.params&&(this.params=e.params),e?.headers&&(this.headers=Object.assign(Object.assign({},this.headers),e.headers)),e?.timeout&&(this.timeout=e.timeout),e?.logger&&(this.logger=e.logger),e?.heartbeatIntervalMs&&(this.heartbeatIntervalMs=e.heartbeatIntervalMs);let s=(r=e?.params)===null||r===void 0?void 0:r.apikey;s&&(this.accessToken=s),this.reconnectAfterMs=e?.reconnectAfterMs?e.reconnectAfterMs:i=>[1e3,2e3,5e3,1e4][i-1]||1e4,this.encode=e?.encode?e.encode:(i,o)=>o(JSON.stringify(i)),this.decode=e?.decode?e.decode:this.serializer.decode.bind(this.serializer),this.reconnectTimer=new K(()=>u(this,null,function*(){this.disconnect(),this.connect()}),this.reconnectAfterMs),this.fetch=this._resolveFetch(e?.fetch)}connect(){if(!this.conn){if(this.transport){this.conn=new this.transport(this._endPointURL(),void 0,{headers:this.headers});return}if(Gt){this.conn=new WebSocket(this._endPointURL()),this.setupConnection();return}this.conn=new Ve(this._endPointURL(),void 0,{close:()=>{this.conn=null}}),import("./chunk-7EJ4JCZP.js").then(({default:t})=>{this.conn=new t(this._endPointURL(),void 0,{headers:this.headers}),this.setupConnection()})}}disconnect(t,e){this.conn&&(this.conn.onclose=function(){},t?this.conn.close(t,e??""):this.conn.close(),this.conn=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.reset())}getChannels(){return this.channels}removeChannel(t){return u(this,null,function*(){let e=yield t.unsubscribe();return this.channels.length===0&&this.disconnect(),e})}removeAllChannels(){return u(this,null,function*(){let t=yield Promise.all(this.channels.map(e=>e.unsubscribe()));return this.disconnect(),t})}log(t,e,r){this.logger(t,e,r)}connectionState(){switch(this.conn&&this.conn.readyState){case G.connecting:return N.Connecting;case G.open:return N.Open;case G.closing:return N.Closing;default:return N.Closed}}isConnected(){return this.connectionState()===N.Open}channel(t,e={config:{}}){let r=new he(`realtime:${t}`,e,this);return this.channels.push(r),r}push(t){let{topic:e,event:r,payload:s,ref:i}=t,o=()=>{this.encode(t,a=>{var c;(c=this.conn)===null||c===void 0||c.send(a)})};this.log("push",`${e} ${r} (${i})`,s),this.isConnected()?o():this.sendBuffer.push(o)}setAuth(t){this.accessToken=t,this.channels.forEach(e=>{t&&e.updateJoinPayload({access_token:t}),e.joinedOnce&&e._isJoined()&&e._push(T.access_token,{access_token:t})})}_makeRef(){let t=this.ref+1;return t===this.ref?this.ref=0:this.ref=t,this.ref.toString()}_leaveOpenTopic(t){let e=this.channels.find(r=>r.topic===t&&(r._isJoined()||r._isJoining()));e&&(this.log("transport",`leaving duplicate topic "${t}"`),e.unsubscribe())}_remove(t){this.channels=this.channels.filter(e=>e._joinRef()!==t._joinRef())}setupConnection(){this.conn&&(this.conn.binaryType="arraybuffer",this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=t=>this._onConnError(t),this.conn.onmessage=t=>this._onConnMessage(t),this.conn.onclose=t=>this._onConnClose(t))}_endPointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:at}))}_onConnMessage(t){this.decode(t.data,e=>{let{topic:r,event:s,payload:i,ref:o}=e;(o&&o===this.pendingHeartbeatRef||s===i?.type)&&(this.pendingHeartbeatRef=null),this.log("receive",`${i.status||""} ${r} ${s} ${o&&"("+o+")"||""}`,i),this.channels.filter(a=>a._isMember(r)).forEach(a=>a._trigger(s,i,o)),this.stateChangeCallbacks.message.forEach(a=>a(e))})}_onConnOpen(){this.log("transport",`connected to ${this._endPointURL()}`),this._flushSendBuffer(),this.reconnectTimer.reset(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this._sendHeartbeat(),this.heartbeatIntervalMs),this.stateChangeCallbacks.open.forEach(t=>t())}_onConnClose(t){this.log("transport","close",t),this._triggerChanError(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach(e=>e(t))}_onConnError(t){this.log("transport",t.message),this._triggerChanError(),this.stateChangeCallbacks.error.forEach(e=>e(t))}_triggerChanError(){this.channels.forEach(t=>t._trigger(T.error))}_appendParams(t,e){if(Object.keys(e).length===0)return t;let r=t.match(/\?/)?"&":"?",s=new URLSearchParams(e);return`${t}${r}${s}`}_flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(t=>t()),this.sendBuffer=[])}_sendHeartbeat(){var t;if(this.isConnected()){if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),(t=this.conn)===null||t===void 0||t.close(ct,"hearbeat timeout");return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.setAuth(this.accessToken)}}};var Ve=class{constructor(t,e,r){this.binaryType="arraybuffer",this.onclose=()=>{},this.onerror=()=>{},this.onmessage=()=>{},this.onopen=()=>{},this.readyState=G.connecting,this.send=()=>{},this.url=null,this.url=t,this.close=r.close}};var W=class extends Error{constructor(t){super(t),this.__isStorageError=!0,this.name="StorageError"}};function b(n){return typeof n=="object"&&n!==null&&"__isStorageError"in n}var Ae=class extends W{constructor(t,e){super(t),this.name="StorageApiError",this.status=e}toJSON(){return{name:this.name,message:this.message,status:this.status}}},de=class extends W{constructor(t,e){super(t),this.name="StorageUnknownError",this.originalError=e}};var Kt=function(n,t,e,r){function s(i){return i instanceof e?i:new e(function(o){o(i)})}return new(e||(e=Promise))(function(i,o){function a(h){try{l(r.next(h))}catch(d){o(d)}}function c(h){try{l(r.throw(h))}catch(d){o(d)}}function l(h){h.done?i(h.value):s(h.value).then(a,c)}l((r=r.apply(n,t||[])).next())})},Re=n=>{let t;return n?t=n:typeof fetch>"u"?t=(...e)=>import("./chunk-2UTJ4IR6.js").then(({default:r})=>r(...e)):t=fetch,(...e)=>t(...e)},ht=()=>Kt(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield import("./chunk-2UTJ4IR6.js")).Response:Response});var X=function(n,t,e,r){function s(i){return i instanceof e?i:new e(function(o){o(i)})}return new(e||(e=Promise))(function(i,o){function a(h){try{l(r.next(h))}catch(d){o(d)}}function c(h){try{l(r.throw(h))}catch(d){o(d)}}function l(h){h.done?i(h.value):s(h.value).then(a,c)}l((r=r.apply(n,t||[])).next())})},We=n=>n.msg||n.message||n.error_description||n.error||JSON.stringify(n),Vt=(n,t)=>X(void 0,void 0,void 0,function*(){let e=yield ht();n instanceof e?n.json().then(r=>{t(new Ae(We(r),n.status||500))}).catch(r=>{t(new de(We(r),r))}):t(new de(We(n),n))}),Wt=(n,t,e,r)=>{let s={method:n,headers:t?.headers||{}};return n==="GET"?s:(s.headers=Object.assign({"Content-Type":"application/json"},t?.headers),s.body=JSON.stringify(r),Object.assign(Object.assign({},s),e))};function je(n,t,e,r,s,i){return X(this,void 0,void 0,function*(){return new Promise((o,a)=>{n(e,Wt(t,r,s,i)).then(c=>{if(!c.ok)throw c;return r?.noResolveJson?c:c.json()}).then(c=>o(c)).catch(c=>Vt(c,a))})})}function fe(n,t,e,r){return X(this,void 0,void 0,function*(){return je(n,"GET",t,e,r)})}function j(n,t,e,r,s){return X(this,void 0,void 0,function*(){return je(n,"POST",t,r,s,e)})}function ut(n,t,e,r,s){return X(this,void 0,void 0,function*(){return je(n,"PUT",t,r,s,e)})}function $e(n,t,e,r,s){return X(this,void 0,void 0,function*(){return je(n,"DELETE",t,r,s,e)})}var E=function(n,t,e,r){function s(i){return i instanceof e?i:new e(function(o){o(i)})}return new(e||(e=Promise))(function(i,o){function a(h){try{l(r.next(h))}catch(d){o(d)}}function c(h){try{l(r.throw(h))}catch(d){o(d)}}function l(h){h.done?i(h.value):s(h.value).then(a,c)}l((r=r.apply(n,t||[])).next())})},Xt={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},dt={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1},Pe=class{constructor(t,e={},r,s){this.url=t,this.headers=e,this.bucketId=r,this.fetch=Re(s)}uploadOrUpdate(t,e,r,s){return E(this,void 0,void 0,function*(){try{let i,o=Object.assign(Object.assign({},dt),s),a=Object.assign(Object.assign({},this.headers),t==="POST"&&{"x-upsert":String(o.upsert)});typeof Blob<"u"&&r instanceof Blob?(i=new FormData,i.append("cacheControl",o.cacheControl),i.append("",r)):typeof FormData<"u"&&r instanceof FormData?(i=r,i.append("cacheControl",o.cacheControl)):(i=r,a["cache-control"]=`max-age=${o.cacheControl}`,a["content-type"]=o.contentType);let c=this._removeEmptyFolders(e),l=this._getFinalPath(c),h=yield this.fetch(`${this.url}/object/${l}`,Object.assign({method:t,body:i,headers:a},o?.duplex?{duplex:o.duplex}:{})),d=yield h.json();return h.ok?{data:{path:c,id:d.Id,fullPath:d.Key},error:null}:{data:null,error:d}}catch(i){if(b(i))return{data:null,error:i};throw i}})}upload(t,e,r){return E(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",t,e,r)})}uploadToSignedUrl(t,e,r,s){return E(this,void 0,void 0,function*(){let i=this._removeEmptyFolders(t),o=this._getFinalPath(i),a=new URL(this.url+`/object/upload/sign/${o}`);a.searchParams.set("token",e);try{let c,l=Object.assign({upsert:dt.upsert},s),h=Object.assign(Object.assign({},this.headers),{"x-upsert":String(l.upsert)});typeof Blob<"u"&&r instanceof Blob?(c=new FormData,c.append("cacheControl",l.cacheControl),c.append("",r)):typeof FormData<"u"&&r instanceof FormData?(c=r,c.append("cacheControl",l.cacheControl)):(c=r,h["cache-control"]=`max-age=${l.cacheControl}`,h["content-type"]=l.contentType);let d=yield this.fetch(a.toString(),{method:"PUT",body:c,headers:h}),p=yield d.json();return d.ok?{data:{path:i,fullPath:p.Key},error:null}:{data:null,error:p}}catch(c){if(b(c))return{data:null,error:c};throw c}})}createSignedUploadUrl(t){return E(this,void 0,void 0,function*(){try{let e=this._getFinalPath(t),r=yield j(this.fetch,`${this.url}/object/upload/sign/${e}`,{},{headers:this.headers}),s=new URL(this.url+r.url),i=s.searchParams.get("token");if(!i)throw new W("No token returned by API");return{data:{signedUrl:s.toString(),path:t,token:i},error:null}}catch(e){if(b(e))return{data:null,error:e};throw e}})}update(t,e,r){return E(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",t,e,r)})}move(t,e){return E(this,void 0,void 0,function*(){try{return{data:yield j(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:t,destinationKey:e},{headers:this.headers}),error:null}}catch(r){if(b(r))return{data:null,error:r};throw r}})}copy(t,e){return E(this,void 0,void 0,function*(){try{return{data:{path:(yield j(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:t,destinationKey:e},{headers:this.headers})).Key},error:null}}catch(r){if(b(r))return{data:null,error:r};throw r}})}createSignedUrl(t,e,r){return E(this,void 0,void 0,function*(){try{let s=this._getFinalPath(t),i=yield j(this.fetch,`${this.url}/object/sign/${s}`,Object.assign({expiresIn:e},r?.transform?{transform:r.transform}:{}),{headers:this.headers}),o=r?.download?`&download=${r.download===!0?"":r.download}`:"";return i={signedUrl:encodeURI(`${this.url}${i.signedURL}${o}`)},{data:i,error:null}}catch(s){if(b(s))return{data:null,error:s};throw s}})}createSignedUrls(t,e,r){return E(this,void 0,void 0,function*(){try{let s=yield j(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:e,paths:t},{headers:this.headers}),i=r?.download?`&download=${r.download===!0?"":r.download}`:"";return{data:s.map(o=>Object.assign(Object.assign({},o),{signedUrl:o.signedURL?encodeURI(`${this.url}${o.signedURL}${i}`):null})),error:null}}catch(s){if(b(s))return{data:null,error:s};throw s}})}download(t,e){return E(this,void 0,void 0,function*(){let s=typeof e?.transform<"u"?"render/image/authenticated":"object",i=this.transformOptsToQueryString(e?.transform||{}),o=i?`?${i}`:"";try{let a=this._getFinalPath(t);return{data:yield(yield fe(this.fetch,`${this.url}/${s}/${a}${o}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(a){if(b(a))return{data:null,error:a};throw a}})}getPublicUrl(t,e){let r=this._getFinalPath(t),s=[],i=e?.download?`download=${e.download===!0?"":e.download}`:"";i!==""&&s.push(i);let a=typeof e?.transform<"u"?"render/image":"object",c=this.transformOptsToQueryString(e?.transform||{});c!==""&&s.push(c);let l=s.join("&");return l!==""&&(l=`?${l}`),{data:{publicUrl:encodeURI(`${this.url}/${a}/public/${r}${l}`)}}}remove(t){return E(this,void 0,void 0,function*(){try{return{data:yield $e(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:t},{headers:this.headers}),error:null}}catch(e){if(b(e))return{data:null,error:e};throw e}})}list(t,e,r){return E(this,void 0,void 0,function*(){try{let s=Object.assign(Object.assign(Object.assign({},Xt),e),{prefix:t||""});return{data:yield j(this.fetch,`${this.url}/object/list/${this.bucketId}`,s,{headers:this.headers},r),error:null}}catch(s){if(b(s))return{data:null,error:s};throw s}})}_getFinalPath(t){return`${this.bucketId}/${t}`}_removeEmptyFolders(t){return t.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(t){let e=[];return t.width&&e.push(`width=${t.width}`),t.height&&e.push(`height=${t.height}`),t.resize&&e.push(`resize=${t.resize}`),t.format&&e.push(`format=${t.format}`),t.quality&&e.push(`quality=${t.quality}`),e.join("&")}};var ft="2.5.5";var pt={"X-Client-Info":`storage-js/${ft}`};var Y=function(n,t,e,r){function s(i){return i instanceof e?i:new e(function(o){o(i)})}return new(e||(e=Promise))(function(i,o){function a(h){try{l(r.next(h))}catch(d){o(d)}}function c(h){try{l(r.throw(h))}catch(d){o(d)}}function l(h){h.done?i(h.value):s(h.value).then(a,c)}l((r=r.apply(n,t||[])).next())})},Ce=class{constructor(t,e={},r){this.url=t,this.headers=Object.assign(Object.assign({},pt),e),this.fetch=Re(r)}listBuckets(){return Y(this,void 0,void 0,function*(){try{return{data:yield fe(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(t){if(b(t))return{data:null,error:t};throw t}})}getBucket(t){return Y(this,void 0,void 0,function*(){try{return{data:yield fe(this.fetch,`${this.url}/bucket/${t}`,{headers:this.headers}),error:null}}catch(e){if(b(e))return{data:null,error:e};throw e}})}createBucket(t,e={public:!1}){return Y(this,void 0,void 0,function*(){try{return{data:yield j(this.fetch,`${this.url}/bucket`,{id:t,name:t,public:e.public,file_size_limit:e.fileSizeLimit,allowed_mime_types:e.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(b(r))return{data:null,error:r};throw r}})}updateBucket(t,e){return Y(this,void 0,void 0,function*(){try{return{data:yield ut(this.fetch,`${this.url}/bucket/${t}`,{id:t,name:t,public:e.public,file_size_limit:e.fileSizeLimit,allowed_mime_types:e.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(b(r))return{data:null,error:r};throw r}})}emptyBucket(t){return Y(this,void 0,void 0,function*(){try{return{data:yield j(this.fetch,`${this.url}/bucket/${t}/empty`,{},{headers:this.headers}),error:null}}catch(e){if(b(e))return{data:null,error:e};throw e}})}deleteBucket(t){return Y(this,void 0,void 0,function*(){try{return{data:yield $e(this.fetch,`${this.url}/bucket/${t}`,{},{headers:this.headers}),error:null}}catch(e){if(b(e))return{data:null,error:e};throw e}})}};var pe=class extends Ce{constructor(t,e={},r){super(t,e,r)}from(t){return new Pe(this.url,this.headers,t,this.fetch)}};var gt="2.39.2";var ge="";typeof Deno<"u"?ge="deno":typeof document<"u"?ge="web":typeof navigator<"u"&&navigator.product==="ReactNative"?ge="react-native":ge="node";var mt={"X-Client-Info":`supabase-js-${ge}/${gt}`};var Yt=function(n,t,e,r){function s(i){return i instanceof e?i:new e(function(o){o(i)})}return new(e||(e=Promise))(function(i,o){function a(h){try{l(r.next(h))}catch(d){o(d)}}function c(h){try{l(r.throw(h))}catch(d){o(d)}}function l(h){h.done?i(h.value):s(h.value).then(a,c)}l((r=r.apply(n,t||[])).next())})},Qt=n=>{let t;return n?t=n:typeof fetch>"u"?t=ke:t=fetch,(...e)=>t(...e)},Zt=()=>typeof Headers>"u"?tt:Headers,_t=(n,t,e)=>{let r=Qt(e),s=Zt();return(i,o)=>Yt(void 0,void 0,void 0,function*(){var a;let c=(a=yield t())!==null&&a!==void 0?a:n,l=new s(o?.headers);return l.has("apikey")||l.set("apikey",n),l.has("Authorization")||l.set("Authorization",`Bearer ${c}`),r(i,Object.assign(Object.assign({},o),{headers:l}))})};function vt(n){return n.replace(/\/$/,"")}function yt(n,t){let{db:e,auth:r,realtime:s,global:i}=n,{db:o,auth:a,realtime:c,global:l}=t;return{db:Object.assign(Object.assign({},o),e),auth:Object.assign(Object.assign({},a),r),realtime:Object.assign(Object.assign({},c),s),global:Object.assign(Object.assign({},l),i)}}function wt(n){return Math.round(Date.now()/1e3)+n}function bt(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(n){let t=Math.random()*16|0;return(n=="x"?t:t&3|8).toString(16)})}var O=()=>typeof document<"u",q={tested:!1,writable:!1},L=()=>{if(!O())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(q.tested)return q.writable;let n=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(n,n),globalThis.localStorage.removeItem(n),q.tested=!0,q.writable=!0}catch{q.tested=!0,q.writable=!1}return q.writable};function Ie(n){let t={},e=new URL(n);if(e.hash&&e.hash[0]==="#")try{new URLSearchParams(e.hash.substring(1)).forEach((s,i)=>{t[i]=s})}catch{}return e.searchParams.forEach((r,s)=>{t[s]=r}),t}var Le=n=>{let t;return n?t=n:typeof fetch>"u"?t=(...e)=>import("./chunk-2UTJ4IR6.js").then(({default:r})=>r(...e)):t=fetch,(...e)=>t(...e)},kt=n=>typeof n=="object"&&n!==null&&"status"in n&&"ok"in n&&"json"in n&&typeof n.json=="function",U=(n,t,e)=>u(void 0,null,function*(){yield n.setItem(t,JSON.stringify(e))}),_e=(n,t)=>u(void 0,null,function*(){let e=yield n.getItem(t);if(!e)return null;try{return JSON.parse(e)}catch{return e}}),Ue=(n,t)=>u(void 0,null,function*(){yield n.removeItem(t)});function er(n){let t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",e="",r,s,i,o,a,c,l,h=0;for(n=n.replace("-","+").replace("_","/");h<n.length;)o=t.indexOf(n.charAt(h++)),a=t.indexOf(n.charAt(h++)),c=t.indexOf(n.charAt(h++)),l=t.indexOf(n.charAt(h++)),r=o<<2|a>>4,s=(a&15)<<4|c>>2,i=(c&3)<<6|l,e=e+String.fromCharCode(r),c!=64&&s!=0&&(e=e+String.fromCharCode(s)),l!=64&&i!=0&&(e=e+String.fromCharCode(i));return e}var me=class n{constructor(){this.promise=new n.promiseConstructor((t,e)=>{this.resolve=t,this.reject=e})}};me.promiseConstructor=Promise;function Xe(n){let t=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}=?$|[a-z0-9_-]{2}(==)?$)$/i,e=n.split(".");if(e.length!==3)throw new Error("JWT is not valid: not a JWT structure");if(!t.test(e[1]))throw new Error("JWT is not valid: payload is not in base64url format");let r=e[1];return JSON.parse(er(r))}function xt(n){return u(this,null,function*(){return yield new Promise(t=>{setTimeout(()=>t(null),n)})})}function St(n,t){return new Promise((r,s)=>{u(this,null,function*(){for(let i=0;i<1/0;i++)try{let o=yield n(i);if(!t(i,null,o)){r(o);return}}catch(o){if(!t(i,o)){s(o);return}}})})}function tr(n){return("0"+n.toString(16)).substr(-2)}function M(){let t=new Uint32Array(56);if(typeof crypto>"u"){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",r=e.length,s="";for(let i=0;i<56;i++)s+=e.charAt(Math.floor(Math.random()*r));return s}return crypto.getRandomValues(t),Array.from(t,tr).join("")}function rr(n){return u(this,null,function*(){let e=new TextEncoder().encode(n),r=yield crypto.subtle.digest("SHA-256",e),s=new Uint8Array(r);return Array.from(s).map(i=>String.fromCharCode(i)).join("")})}function sr(n){return btoa(n).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}function J(n){return u(this,null,function*(){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),n;let e=yield rr(n);return sr(e)})}var ve=class extends Error{constructor(t,e){super(t),this.__isAuthError=!0,this.name="AuthError",this.status=e}};function _(n){return typeof n=="object"&&n!==null&&"__isAuthError"in n}var De=class extends ve{constructor(t,e){super(t,e),this.name="AuthApiError",this.status=e}toJSON(){return{name:this.name,message:this.message,status:this.status}}};function Tt(n){return _(n)&&n.name==="AuthApiError"}var Q=class extends ve{constructor(t,e){super(t),this.name="AuthUnknownError",this.originalError=e}},C=class extends ve{constructor(t,e,r){super(t),this.name=e,this.status=r}toJSON(){return{name:this.name,message:this.message,status:this.status}}},I=class extends C{constructor(){super("Auth session missing!","AuthSessionMissingError",400)}},Z=class extends C{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500)}},B=class extends C{constructor(t){super(t,"AuthInvalidCredentialsError",400)}},z=class extends C{constructor(t,e=null){super(t,"AuthImplicitGrantRedirectError",500),this.details=null,this.details=e}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}},ye=class extends C{constructor(t,e=null){super(t,"AuthPKCEGrantCodeExchangeError",500),this.details=null,this.details=e}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}},ee=class extends C{constructor(t,e){super(t,"AuthRetryableFetchError",e)}};function Ne(n){return _(n)&&n.name==="AuthRetryableFetchError"}var Fe=class extends C{constructor(t,e,r){super(t,"AuthWeakPasswordError",e),this.reasons=r}};var ir=function(n,t){var e={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&t.indexOf(r)<0&&(e[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(n);s<r.length;s++)t.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(n,r[s])&&(e[r[s]]=n[r[s]]);return e},te=n=>n.msg||n.message||n.error_description||n.error||JSON.stringify(n),nr=[502,503,504];function Et(n){return u(this,null,function*(){if(!kt(n))throw new ee(te(n),0);if(nr.includes(n.status))throw new ee(te(n),n.status);let t;try{t=yield n.json()}catch(e){throw new Q(te(e),e)}throw typeof t=="object"&&t&&typeof t.weak_password=="object"&&t.weak_password&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.reasons.reduce((e,r)=>e&&typeof r=="string",!0)?new Fe(te(t),n.status,t.weak_password.reasons):new De(te(t),n.status||500)})}var or=(n,t,e,r)=>{let s={method:n,headers:t?.headers||{}};return n==="GET"?s:(s.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},t?.headers),s.body=JSON.stringify(r),Object.assign(Object.assign({},s),e))};function v(n,t,e,r){return u(this,null,function*(){var s;let i=Object.assign({},r?.headers);r?.jwt&&(i.Authorization=`Bearer ${r.jwt}`);let o=(s=r?.query)!==null&&s!==void 0?s:{};r?.redirectTo&&(o.redirect_to=r.redirectTo);let a=Object.keys(o).length?"?"+new URLSearchParams(o).toString():"",c=yield ar(n,t,e+a,{headers:i,noResolveJson:r?.noResolveJson},{},r?.body);return r?.xform?r?.xform(c):{data:Object.assign({},c),error:null}})}function ar(n,t,e,r,s,i){return u(this,null,function*(){let o=or(t,r,s,i),a;try{a=yield n(e,o)}catch(c){throw console.error(c),new ee(te(c),0)}if(a.ok||(yield Et(a)),r?.noResolveJson)return a;try{return yield a.json()}catch(c){yield Et(c)}})}function D(n){var t;let e=null;cr(n)&&(e=Object.assign({},n),n.expires_at||(e.expires_at=wt(n.expires_in)));let r=(t=n.user)!==null&&t!==void 0?t:n;return{data:{session:e,user:r},error:null}}function Ye(n){let t=D(n);return!t.error&&n.weak_password&&typeof n.weak_password=="object"&&Array.isArray(n.weak_password.reasons)&&n.weak_password.reasons.length&&n.weak_password.message&&typeof n.weak_password.message=="string"&&n.weak_password.reasons.reduce((e,r)=>e&&typeof r=="string",!0)&&(t.data.weak_password=n.weak_password),t}function $(n){var t;return{data:{user:(t=n.user)!==null&&t!==void 0?t:n},error:null}}function Ot(n){return{data:n,error:null}}function At(n){let{action_link:t,email_otp:e,hashed_token:r,redirect_to:s,verification_type:i}=n,o=ir(n,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),a={action_link:t,email_otp:e,hashed_token:r,redirect_to:s,verification_type:i},c=Object.assign({},o);return{data:{properties:a,user:c},error:null}}function Rt(n){return n}function cr(n){return n.access_token&&n.refresh_token&&n.expires_in}var lr=function(n,t){var e={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&t.indexOf(r)<0&&(e[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(n);s<r.length;s++)t.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(n,r[s])&&(e[r[s]]=n[r[s]]);return e},re=class{constructor({url:t="",headers:e={},fetch:r}){this.url=t,this.headers=e,this.fetch=Le(r),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}signOut(t,e="global"){return u(this,null,function*(){try{return yield v(this.fetch,"POST",`${this.url}/logout?scope=${e}`,{headers:this.headers,jwt:t,noResolveJson:!0}),{data:null,error:null}}catch(r){if(_(r))return{data:null,error:r};throw r}})}inviteUserByEmail(r){return u(this,arguments,function*(t,e={}){try{return yield v(this.fetch,"POST",`${this.url}/invite`,{body:{email:t,data:e.data},headers:this.headers,redirectTo:e.redirectTo,xform:$})}catch(s){if(_(s))return{data:{user:null},error:s};throw s}})}generateLink(t){return u(this,null,function*(){try{let{options:e}=t,r=lr(t,["options"]),s=Object.assign(Object.assign({},r),e);return"newEmail"in r&&(s.new_email=r?.newEmail,delete s.newEmail),yield v(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:s,headers:this.headers,xform:At,redirectTo:e?.redirectTo})}catch(e){if(_(e))return{data:{properties:null,user:null},error:e};throw e}})}createUser(t){return u(this,null,function*(){try{return yield v(this.fetch,"POST",`${this.url}/admin/users`,{body:t,headers:this.headers,xform:$})}catch(e){if(_(e))return{data:{user:null},error:e};throw e}})}listUsers(t){return u(this,null,function*(){var e,r,s,i,o,a,c;try{let l={nextPage:null,lastPage:0,total:0},h=yield v(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(r=(e=t?.page)===null||e===void 0?void 0:e.toString())!==null&&r!==void 0?r:"",per_page:(i=(s=t?.perPage)===null||s===void 0?void 0:s.toString())!==null&&i!==void 0?i:""},xform:Rt});if(h.error)throw h.error;let d=yield h.json(),p=(o=h.headers.get("x-total-count"))!==null&&o!==void 0?o:0,f=(c=(a=h.headers.get("link"))===null||a===void 0?void 0:a.split(","))!==null&&c!==void 0?c:[];return f.length>0&&(f.forEach(y=>{let g=parseInt(y.split(";")[0].split("=")[1].substring(0,1)),m=JSON.parse(y.split(";")[1].split("=")[1]);l[`${m}Page`]=g}),l.total=parseInt(p)),{data:Object.assign(Object.assign({},d),l),error:null}}catch(l){if(_(l))return{data:{users:[]},error:l};throw l}})}getUserById(t){return u(this,null,function*(){try{return yield v(this.fetch,"GET",`${this.url}/admin/users/${t}`,{headers:this.headers,xform:$})}catch(e){if(_(e))return{data:{user:null},error:e};throw e}})}updateUserById(t,e){return u(this,null,function*(){try{return yield v(this.fetch,"PUT",`${this.url}/admin/users/${t}`,{body:e,headers:this.headers,xform:$})}catch(r){if(_(r))return{data:{user:null},error:r};throw r}})}deleteUser(t,e=!1){return u(this,null,function*(){try{return yield v(this.fetch,"DELETE",`${this.url}/admin/users/${t}`,{headers:this.headers,body:{should_soft_delete:e},xform:$})}catch(r){if(_(r))return{data:{user:null},error:r};throw r}})}_listFactors(t){return u(this,null,function*(){try{let{data:e,error:r}=yield v(this.fetch,"GET",`${this.url}/admin/users/${t.userId}/factors`,{headers:this.headers,xform:s=>({data:{factors:s},error:null})});return{data:e,error:r}}catch(e){if(_(e))return{data:null,error:e};throw e}})}_deleteFactor(t){return u(this,null,function*(){try{return{data:yield v(this.fetch,"DELETE",`${this.url}/admin/users/${t.userId}/factors/${t.id}`,{headers:this.headers}),error:null}}catch(e){if(_(e))return{data:null,error:e};throw e}})}};var qe="2.62.0";var jt="http://localhost:9999",$t="supabase.auth.token";var Pt={"X-Client-Info":`gotrue-js/${qe}`},Qe=10;var Ct={getItem:n=>L()?globalThis.localStorage.getItem(n):null,setItem:(n,t)=>{L()&&globalThis.localStorage.setItem(n,t)},removeItem:n=>{L()&&globalThis.localStorage.removeItem(n)}};function Ze(n={}){return{getItem:t=>n[t]||null,setItem:(t,e)=>{n[t]=e},removeItem:t=>{delete n[t]}}}function It(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}var H={debug:!!(globalThis&&L()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")},we=class extends Error{constructor(t){super(t),this.isAcquireTimeout=!0}},Me=class extends we{};function et(n,t,e){return u(this,null,function*(){H.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",n,t);let r=new globalThis.AbortController;return t>0&&setTimeout(()=>{r.abort(),H.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",n)},t),yield globalThis.navigator.locks.request(n,t===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:r.signal},s=>u(this,null,function*(){if(s){H.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",n,s.name);try{return yield e()}finally{H.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",n,s.name)}}else{if(t===0)throw H.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",n),new Me(`Acquiring an exclusive Navigator LockManager lock "${n}" immediately failed`);if(H.debug)try{let i=yield globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(i,null,"  "))}catch(i){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",i)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),yield e()}}))})}It();var hr={url:jt,storageKey:$t,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:Pt,flowType:"implicit",debug:!1},be=30*1e3,Lt=3;function Ut(n,t,e){return u(this,null,function*(){return yield e()})}var Je=(()=>{class n{constructor(e){var r,s;this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=n.nextInstanceID,n.nextInstanceID+=1,this.instanceID>0&&O()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");let i=Object.assign(Object.assign({},hr),e);if(this.logDebugMessages=!!i.debug,typeof i.debug=="function"&&(this.logger=i.debug),this.persistSession=i.persistSession,this.storageKey=i.storageKey,this.autoRefreshToken=i.autoRefreshToken,this.admin=new re({url:i.url,headers:i.headers,fetch:i.fetch}),this.url=i.url,this.headers=i.headers,this.fetch=Le(i.fetch),this.lock=i.lock||Ut,this.detectSessionInUrl=i.detectSessionInUrl,this.flowType=i.flowType,i.lock?this.lock=i.lock:O()&&(!((r=globalThis?.navigator)===null||r===void 0)&&r.locks)?this.lock=et:this.lock=Ut,this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?i.storage?this.storage=i.storage:L()?this.storage=Ct:(this.memoryStorage={},this.storage=Ze(this.memoryStorage)):(this.memoryStorage={},this.storage=Ze(this.memoryStorage)),O()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(o){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",o)}(s=this.broadcastChannel)===null||s===void 0||s.addEventListener("message",o=>u(this,null,function*(){this._debug("received broadcast notification from other tab or client",o),yield this._notifyAllSubscribers(o.data.event,o.data.session,!1)}))}this.initialize()}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${qe}) ${new Date().toISOString()}`,...e),this}initialize(){return u(this,null,function*(){return this.initializePromise?yield this.initializePromise:(this.initializePromise=(()=>u(this,null,function*(){return yield this._acquireLock(-1,()=>u(this,null,function*(){return yield this._initialize()}))}))(),yield this.initializePromise)})}_initialize(){return u(this,null,function*(){try{let e=O()?yield this._isPKCEFlow():!1;if(this._debug("#_initialize()","begin","is PKCE flow",e),e||this.detectSessionInUrl&&this._isImplicitGrantFlow()){let{data:r,error:s}=yield this._getSessionFromURL(e);if(s)return this._debug("#_initialize()","error detecting session from URL",s),s?.message==="Identity is already linked"||s?.message==="Identity is already linked to another user"?{error:s}:(yield this._removeSession(),{error:s});let{session:i,redirectType:o}=r;return this._debug("#_initialize()","detected session in URL",i,"redirect type",o),yield this._saveSession(i),setTimeout(()=>u(this,null,function*(){o==="recovery"?yield this._notifyAllSubscribers("PASSWORD_RECOVERY",i):yield this._notifyAllSubscribers("SIGNED_IN",i)}),0),{error:null}}return yield this._recoverAndRefresh(),{error:null}}catch(e){return _(e)?{error:e}:{error:new Q("Unexpected error during initialization",e)}}finally{yield this._handleVisibilityChange(),this._debug("#_initialize()","end")}})}signUp(e){return u(this,null,function*(){var r,s,i;try{yield this._removeSession();let o;if("email"in e){let{email:d,password:p,options:f}=e,y=null,g=null;if(this.flowType==="pkce"){let m=M();yield U(this.storage,`${this.storageKey}-code-verifier`,m),y=yield J(m),g=m===y?"plain":"s256"}o=yield v(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:f?.emailRedirectTo,body:{email:d,password:p,data:(r=f?.data)!==null&&r!==void 0?r:{},gotrue_meta_security:{captcha_token:f?.captchaToken},code_challenge:y,code_challenge_method:g},xform:D})}else if("phone"in e){let{phone:d,password:p,options:f}=e;o=yield v(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:d,password:p,data:(s=f?.data)!==null&&s!==void 0?s:{},channel:(i=f?.channel)!==null&&i!==void 0?i:"sms",gotrue_meta_security:{captcha_token:f?.captchaToken}},xform:D})}else throw new B("You must provide either an email or phone number and a password");let{data:a,error:c}=o;if(c||!a)return{data:{user:null,session:null},error:c};let l=a.session,h=a.user;return a.session&&(yield this._saveSession(a.session),yield this._notifyAllSubscribers("SIGNED_IN",l)),{data:{user:h,session:l},error:null}}catch(o){if(_(o))return{data:{user:null,session:null},error:o};throw o}})}signInWithPassword(e){return u(this,null,function*(){try{yield this._removeSession();let r;if("email"in e){let{email:o,password:a,options:c}=e;r=yield v(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:o,password:a,gotrue_meta_security:{captcha_token:c?.captchaToken}},xform:Ye})}else if("phone"in e){let{phone:o,password:a,options:c}=e;r=yield v(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:o,password:a,gotrue_meta_security:{captcha_token:c?.captchaToken}},xform:Ye})}else throw new B("You must provide either an email or phone number and a password");let{data:s,error:i}=r;return i?{data:{user:null,session:null},error:i}:!s||!s.session||!s.user?{data:{user:null,session:null},error:new Z}:(s.session&&(yield this._saveSession(s.session),yield this._notifyAllSubscribers("SIGNED_IN",s.session)),{data:Object.assign({user:s.user,session:s.session},s.weak_password?{weakPassword:s.weak_password}:null),error:i})}catch(r){if(_(r))return{data:{user:null,session:null},error:r};throw r}})}signInWithOAuth(e){return u(this,null,function*(){var r,s,i,o;return yield this._removeSession(),yield this._handleProviderSignIn(e.provider,{redirectTo:(r=e.options)===null||r===void 0?void 0:r.redirectTo,scopes:(s=e.options)===null||s===void 0?void 0:s.scopes,queryParams:(i=e.options)===null||i===void 0?void 0:i.queryParams,skipBrowserRedirect:(o=e.options)===null||o===void 0?void 0:o.skipBrowserRedirect})})}exchangeCodeForSession(e){return u(this,null,function*(){return yield this.initializePromise,this._acquireLock(-1,()=>u(this,null,function*(){return this._exchangeCodeForSession(e)}))})}_exchangeCodeForSession(e){return u(this,null,function*(){let r=yield _e(this.storage,`${this.storageKey}-code-verifier`),[s,i]=(r??"").split("/"),{data:o,error:a}=yield v(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:s},xform:D});return yield Ue(this.storage,`${this.storageKey}-code-verifier`),a?{data:{user:null,session:null,redirectType:null},error:a}:!o||!o.session||!o.user?{data:{user:null,session:null,redirectType:null},error:new Z}:(o.session&&(yield this._saveSession(o.session),yield this._notifyAllSubscribers("SIGNED_IN",o.session)),{data:Object.assign(Object.assign({},o),{redirectType:i??null}),error:a})})}signInWithIdToken(e){return u(this,null,function*(){yield this._removeSession();try{let{options:r,provider:s,token:i,access_token:o,nonce:a}=e,c=yield v(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:s,id_token:i,access_token:o,nonce:a,gotrue_meta_security:{captcha_token:r?.captchaToken}},xform:D}),{data:l,error:h}=c;return h?{data:{user:null,session:null},error:h}:!l||!l.session||!l.user?{data:{user:null,session:null},error:new Z}:(l.session&&(yield this._saveSession(l.session),yield this._notifyAllSubscribers("SIGNED_IN",l.session)),{data:l,error:h})}catch(r){if(_(r))return{data:{user:null,session:null},error:r};throw r}})}signInWithOtp(e){return u(this,null,function*(){var r,s,i,o,a;try{if(yield this._removeSession(),"email"in e){let{email:c,options:l}=e,h=null,d=null;if(this.flowType==="pkce"){let f=M();yield U(this.storage,`${this.storageKey}-code-verifier`,f),h=yield J(f),d=f===h?"plain":"s256"}let{error:p}=yield v(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:c,data:(r=l?.data)!==null&&r!==void 0?r:{},create_user:(s=l?.shouldCreateUser)!==null&&s!==void 0?s:!0,gotrue_meta_security:{captcha_token:l?.captchaToken},code_challenge:h,code_challenge_method:d},redirectTo:l?.emailRedirectTo});return{data:{user:null,session:null},error:p}}if("phone"in e){let{phone:c,options:l}=e,{data:h,error:d}=yield v(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:c,data:(i=l?.data)!==null&&i!==void 0?i:{},create_user:(o=l?.shouldCreateUser)!==null&&o!==void 0?o:!0,gotrue_meta_security:{captcha_token:l?.captchaToken},channel:(a=l?.channel)!==null&&a!==void 0?a:"sms"}});return{data:{user:null,session:null,messageId:h?.message_id},error:d}}throw new B("You must provide either an email or phone number.")}catch(c){if(_(c))return{data:{user:null,session:null},error:c};throw c}})}verifyOtp(e){return u(this,null,function*(){var r,s;try{e.type!=="email_change"&&e.type!=="phone_change"&&(yield this._removeSession());let i,o;"options"in e&&(i=(r=e.options)===null||r===void 0?void 0:r.redirectTo,o=(s=e.options)===null||s===void 0?void 0:s.captchaToken);let{data:a,error:c}=yield v(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:o}}),redirectTo:i,xform:D});if(c)throw c;if(!a)throw new Error("An error occurred on token verification.");let l=a.session,h=a.user;return l?.access_token&&(yield this._saveSession(l),yield this._notifyAllSubscribers("SIGNED_IN",l)),{data:{user:h,session:l},error:null}}catch(i){if(_(i))return{data:{user:null,session:null},error:i};throw i}})}signInWithSSO(e){return u(this,null,function*(){var r,s,i;try{yield this._removeSession();let o=null,a=null;if(this.flowType==="pkce"){let c=M();yield U(this.storage,`${this.storageKey}-code-verifier`,c),o=yield J(c),a=c===o?"plain":"s256"}return yield v(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(s=(r=e.options)===null||r===void 0?void 0:r.redirectTo)!==null&&s!==void 0?s:void 0}),!((i=e?.options)===null||i===void 0)&&i.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:o,code_challenge_method:a}),headers:this.headers,xform:Ot})}catch(o){if(_(o))return{data:null,error:o};throw o}})}reauthenticate(){return u(this,null,function*(){return yield this.initializePromise,yield this._acquireLock(-1,()=>u(this,null,function*(){return yield this._reauthenticate()}))})}_reauthenticate(){return u(this,null,function*(){try{return yield this._useSession(e=>u(this,null,function*(){let{data:{session:r},error:s}=e;if(s)throw s;if(!r)throw new I;let{error:i}=yield v(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:r.access_token});return{data:{user:null,session:null},error:i}}))}catch(e){if(_(e))return{data:{user:null,session:null},error:e};throw e}})}resend(e){return u(this,null,function*(){try{e.type!="email_change"&&e.type!="phone_change"&&(yield this._removeSession());let r=`${this.url}/resend`;if("email"in e){let{email:s,type:i,options:o}=e,{error:a}=yield v(this.fetch,"POST",r,{headers:this.headers,body:{email:s,type:i,gotrue_meta_security:{captcha_token:o?.captchaToken}},redirectTo:o?.emailRedirectTo});return{data:{user:null,session:null},error:a}}else if("phone"in e){let{phone:s,type:i,options:o}=e,{data:a,error:c}=yield v(this.fetch,"POST",r,{headers:this.headers,body:{phone:s,type:i,gotrue_meta_security:{captcha_token:o?.captchaToken}}});return{data:{user:null,session:null,messageId:a?.message_id},error:c}}throw new B("You must provide either an email or phone number and a type")}catch(r){if(_(r))return{data:{user:null,session:null},error:r};throw r}})}getSession(){return u(this,null,function*(){return yield this.initializePromise,this._acquireLock(-1,()=>u(this,null,function*(){return this._useSession(e=>u(this,null,function*(){return e}))}))})}_acquireLock(e,r){return u(this,null,function*(){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){let s=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),i=(()=>u(this,null,function*(){return yield s,yield r()}))();return this.pendingInLock.push((()=>u(this,null,function*(){try{yield i}catch{}}))()),i}return yield this.lock(`lock:${this.storageKey}`,e,()=>u(this,null,function*(){this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;let s=r();for(this.pendingInLock.push((()=>u(this,null,function*(){try{yield s}catch{}}))()),yield s;this.pendingInLock.length;){let i=[...this.pendingInLock];yield Promise.all(i),this.pendingInLock.splice(0,i.length)}return yield s}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}}))}finally{this._debug("#_acquireLock","end")}})}_useSession(e){return u(this,null,function*(){this._debug("#_useSession","begin");try{let r=yield this.__loadSession();return yield e(r)}finally{this._debug("#_useSession","end")}})}__loadSession(){return u(this,null,function*(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null,r=yield _e(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",r),r!==null&&(this._isValidSession(r)?e=r:(this._debug("#getSession()","session from storage is not valid"),yield this._removeSession())),!e)return{data:{session:null},error:null};let s=e.expires_at?e.expires_at<=Date.now()/1e3:!1;if(this._debug("#__loadSession()",`session has${s?"":" not"} expired`,"expires_at",e.expires_at),!s)return{data:{session:e},error:null};let{session:i,error:o}=yield this._callRefreshToken(e.refresh_token);return o?{data:{session:null},error:o}:{data:{session:i},error:null}}finally{this._debug("#__loadSession()","end")}})}getUser(e){return u(this,null,function*(){return e?yield this._getUser(e):(yield this.initializePromise,this._acquireLock(-1,()=>u(this,null,function*(){return yield this._getUser()})))})}_getUser(e){return u(this,null,function*(){try{return e?yield v(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:$}):yield this._useSession(r=>u(this,null,function*(){var s,i;let{data:o,error:a}=r;if(a)throw a;return yield v(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(i=(s=o.session)===null||s===void 0?void 0:s.access_token)!==null&&i!==void 0?i:void 0,xform:$})}))}catch(r){if(_(r))return{data:{user:null},error:r};throw r}})}updateUser(s){return u(this,arguments,function*(e,r={}){return yield this.initializePromise,yield this._acquireLock(-1,()=>u(this,null,function*(){return yield this._updateUser(e,r)}))})}_updateUser(s){return u(this,arguments,function*(e,r={}){try{return yield this._useSession(i=>u(this,null,function*(){let{data:o,error:a}=i;if(a)throw a;if(!o.session)throw new I;let c=o.session,l=null,h=null;if(this.flowType==="pkce"&&e.email!=null){let f=M();yield U(this.storage,`${this.storageKey}-code-verifier`,f),l=yield J(f),h=f===l?"plain":"s256"}let{data:d,error:p}=yield v(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:r?.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:l,code_challenge_method:h}),jwt:c.access_token,xform:$});if(p)throw p;return c.user=d.user,yield this._saveSession(c),yield this._notifyAllSubscribers("USER_UPDATED",c),{data:{user:c.user},error:null}}))}catch(i){if(_(i))return{data:{user:null},error:i};throw i}})}_decodeJWT(e){return Xe(e)}setSession(e){return u(this,null,function*(){return yield this.initializePromise,yield this._acquireLock(-1,()=>u(this,null,function*(){return yield this._setSession(e)}))})}_setSession(e){return u(this,null,function*(){try{if(!e.access_token||!e.refresh_token)throw new I;let r=Date.now()/1e3,s=r,i=!0,o=null,a=Xe(e.access_token);if(a.exp&&(s=a.exp,i=s<=r),i){let{session:c,error:l}=yield this._callRefreshToken(e.refresh_token);if(l)return{data:{user:null,session:null},error:l};if(!c)return{data:{user:null,session:null},error:null};o=c}else{let{data:c,error:l}=yield this._getUser(e.access_token);if(l)throw l;o={access_token:e.access_token,refresh_token:e.refresh_token,user:c.user,token_type:"bearer",expires_in:s-r,expires_at:s},yield this._saveSession(o),yield this._notifyAllSubscribers("SIGNED_IN",o)}return{data:{user:o.user,session:o},error:null}}catch(r){if(_(r))return{data:{session:null,user:null},error:r};throw r}})}refreshSession(e){return u(this,null,function*(){return yield this.initializePromise,yield this._acquireLock(-1,()=>u(this,null,function*(){return yield this._refreshSession(e)}))})}_refreshSession(e){return u(this,null,function*(){try{return yield this._useSession(r=>u(this,null,function*(){var s;if(!e){let{data:a,error:c}=r;if(c)throw c;e=(s=a.session)!==null&&s!==void 0?s:void 0}if(!e?.refresh_token)throw new I;let{session:i,error:o}=yield this._callRefreshToken(e.refresh_token);return o?{data:{user:null,session:null},error:o}:i?{data:{user:i.user,session:i},error:null}:{data:{user:null,session:null},error:null}}))}catch(r){if(_(r))return{data:{user:null,session:null},error:r};throw r}})}_getSessionFromURL(e){return u(this,null,function*(){try{if(!O())throw new z("No browser detected.");if(this.flowType==="implicit"&&!this._isImplicitGrantFlow())throw new z("Not a valid implicit grant flow url.");if(this.flowType=="pkce"&&!e)throw new ye("Not a valid PKCE flow url.");let r=Ie(window.location.href);if(e){if(!r.code)throw new ye("No code detected.");let{data:P,error:x}=yield this._exchangeCodeForSession(r.code);if(x)throw x;let F=new URL(window.location.href);return F.searchParams.delete("code"),window.history.replaceState(window.history.state,"",F.toString()),{data:{session:P.session,redirectType:null},error:null}}if(r.error||r.error_description||r.error_code)throw new z(r.error_description||"Error in URL with unspecified error_description",{error:r.error||"unspecified_error",code:r.error_code||"unspecified_code"});let{provider_token:s,provider_refresh_token:i,access_token:o,refresh_token:a,expires_in:c,expires_at:l,token_type:h}=r;if(!o||!c||!a||!h)throw new z("No session defined in URL");let d=Math.round(Date.now()/1e3),p=parseInt(c),f=d+p;l&&(f=parseInt(l));let y=f-d;y*1e3<=be&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${y}s, should have been closer to ${p}s`);let g=f-p;d-g>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",g,f,d):d-g<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clok for skew",g,f,d);let{data:m,error:k}=yield this._getUser(o);if(k)throw k;let A={provider_token:s,provider_refresh_token:i,access_token:o,expires_in:p,expires_at:f,refresh_token:a,token_type:h,user:m.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:A,redirectType:r.type},error:null}}catch(r){if(_(r))return{data:{session:null,redirectType:null},error:r};throw r}})}_isImplicitGrantFlow(){let e=Ie(window.location.href);return!!(O()&&(e.access_token||e.error_description))}_isPKCEFlow(){return u(this,null,function*(){let e=Ie(window.location.href),r=yield _e(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&r)})}signOut(){return u(this,arguments,function*(e={scope:"global"}){return yield this.initializePromise,yield this._acquireLock(-1,()=>u(this,null,function*(){return yield this._signOut(e)}))})}_signOut(){return u(this,arguments,function*({scope:e}={scope:"global"}){return yield this._useSession(r=>u(this,null,function*(){var s;let{data:i,error:o}=r;if(o)return{error:o};let a=(s=i.session)===null||s===void 0?void 0:s.access_token;if(a){let{error:c}=yield this.admin.signOut(a,e);if(c&&!(Tt(c)&&(c.status===404||c.status===401)))return{error:c}}return e!=="others"&&(yield this._removeSession(),yield Ue(this.storage,`${this.storageKey}-code-verifier`),yield this._notifyAllSubscribers("SIGNED_OUT",null)),{error:null}}))})}onAuthStateChange(e){let r=bt(),s={id:r,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",r),this.stateChangeEmitters.delete(r)}};return this._debug("#onAuthStateChange()","registered callback with id",r),this.stateChangeEmitters.set(r,s),u(this,null,function*(){yield this.initializePromise,yield this._acquireLock(-1,()=>u(this,null,function*(){this._emitInitialSession(r)}))}),{data:{subscription:s}}}_emitInitialSession(e){return u(this,null,function*(){return yield this._useSession(r=>u(this,null,function*(){var s,i;try{let{data:{session:o},error:a}=r;if(a)throw a;yield(s=this.stateChangeEmitters.get(e))===null||s===void 0?void 0:s.callback("INITIAL_SESSION",o),this._debug("INITIAL_SESSION","callback id",e,"session",o)}catch(o){yield(i=this.stateChangeEmitters.get(e))===null||i===void 0?void 0:i.callback("INITIAL_SESSION",null),this._debug("INITIAL_SESSION","callback id",e,"error",o),console.error(o)}}))})}resetPasswordForEmail(s){return u(this,arguments,function*(e,r={}){let i=null,o=null;if(this.flowType==="pkce"){let a=M();yield U(this.storage,`${this.storageKey}-code-verifier`,`${a}/PASSWORD_RECOVERY`),i=yield J(a),o=a===i?"plain":"s256"}try{return yield v(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:i,code_challenge_method:o,gotrue_meta_security:{captcha_token:r.captchaToken}},headers:this.headers,redirectTo:r.redirectTo})}catch(a){if(_(a))return{data:null,error:a};throw a}})}getUserIdentities(){return u(this,null,function*(){var e;try{let{data:r,error:s}=yield this.getUser();if(s)throw s;return{data:{identities:(e=r.user.identities)!==null&&e!==void 0?e:[]},error:null}}catch(r){if(_(r))return{data:null,error:r};throw r}})}linkIdentity(e){return u(this,null,function*(){var r;try{let{data:s,error:i}=yield this._useSession(o=>u(this,null,function*(){var a,c,l,h,d;let{data:p,error:f}=o;if(f)throw f;let y=yield this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(a=e.options)===null||a===void 0?void 0:a.redirectTo,scopes:(c=e.options)===null||c===void 0?void 0:c.scopes,queryParams:(l=e.options)===null||l===void 0?void 0:l.queryParams,skipBrowserRedirect:!0});return yield v(this.fetch,"GET",y,{headers:this.headers,jwt:(d=(h=p.session)===null||h===void 0?void 0:h.access_token)!==null&&d!==void 0?d:void 0})}));if(i)throw i;return O()&&!(!((r=e.options)===null||r===void 0)&&r.skipBrowserRedirect)&&window.location.assign(s?.url),{data:{provider:e.provider,url:s?.url},error:null}}catch(s){if(_(s))return{data:{provider:e.provider,url:null},error:s};throw s}})}unlinkIdentity(e){return u(this,null,function*(){try{return yield this._useSession(r=>u(this,null,function*(){var s,i;let{data:o,error:a}=r;if(a)throw a;return yield v(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(i=(s=o.session)===null||s===void 0?void 0:s.access_token)!==null&&i!==void 0?i:void 0})}))}catch(r){if(_(r))return{data:null,error:r};throw r}})}_refreshAccessToken(e){return u(this,null,function*(){let r=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(r,"begin");try{let s=Date.now();return yield St(i=>u(this,null,function*(){return yield xt(i*200),this._debug(r,"refreshing attempt",i),yield v(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:D})}),(i,o,a)=>a&&a.error&&Ne(a.error)&&Date.now()+(i+1)*200-s<be)}catch(s){if(this._debug(r,"error",s),_(s))return{data:{session:null,user:null},error:s};throw s}finally{this._debug(r,"end")}})}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}_handleProviderSignIn(e,r){return u(this,null,function*(){let s=yield this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:r.redirectTo,scopes:r.scopes,queryParams:r.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",r,"url",s),O()&&!r.skipBrowserRedirect&&window.location.assign(s),{data:{provider:e,url:s},error:null}})}_recoverAndRefresh(){return u(this,null,function*(){var e;let r="#_recoverAndRefresh()";this._debug(r,"begin");try{let s=yield _e(this.storage,this.storageKey);if(this._debug(r,"session from storage",s),!this._isValidSession(s)){this._debug(r,"session is not valid"),s!==null&&(yield this._removeSession());return}let i=Math.round(Date.now()/1e3),o=((e=s.expires_at)!==null&&e!==void 0?e:1/0)<i+Qe;if(this._debug(r,`session has${o?"":" not"} expired with margin of ${Qe}s`),o){if(this.autoRefreshToken&&s.refresh_token){let{error:a}=yield this._callRefreshToken(s.refresh_token);a&&(console.error(a),Ne(a)||(this._debug(r,"refresh failed with a non-retryable error, removing the session",a),yield this._removeSession()))}}else yield this._notifyAllSubscribers("SIGNED_IN",s)}catch(s){this._debug(r,"error",s),console.error(s);return}finally{this._debug(r,"end")}})}_callRefreshToken(e){return u(this,null,function*(){var r,s;if(!e)throw new I;if(this.refreshingDeferred)return this.refreshingDeferred.promise;let i=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(i,"begin");try{this.refreshingDeferred=new me;let{data:o,error:a}=yield this._refreshAccessToken(e);if(a)throw a;if(!o.session)throw new I;yield this._saveSession(o.session),yield this._notifyAllSubscribers("TOKEN_REFRESHED",o.session);let c={session:o.session,error:null};return this.refreshingDeferred.resolve(c),c}catch(o){if(this._debug(i,"error",o),_(o)){let a={session:null,error:o};return Ne(o)||(yield this._removeSession(),yield this._notifyAllSubscribers("SIGNED_OUT",null)),(r=this.refreshingDeferred)===null||r===void 0||r.resolve(a),a}throw(s=this.refreshingDeferred)===null||s===void 0||s.reject(o),o}finally{this.refreshingDeferred=null,this._debug(i,"end")}})}_notifyAllSubscribers(e,r,s=!0){return u(this,null,function*(){let i=`#_notifyAllSubscribers(${e})`;this._debug(i,"begin",r,`broadcast = ${s}`);try{this.broadcastChannel&&s&&this.broadcastChannel.postMessage({event:e,session:r});let o=[],a=Array.from(this.stateChangeEmitters.values()).map(c=>u(this,null,function*(){try{yield c.callback(e,r)}catch(l){o.push(l)}}));if(yield Promise.all(a),o.length>0){for(let c=0;c<o.length;c+=1)console.error(o[c]);throw o[0]}}finally{this._debug(i,"end")}})}_saveSession(e){return u(this,null,function*(){this._debug("#_saveSession()",e),yield U(this.storage,this.storageKey,e)})}_removeSession(){return u(this,null,function*(){this._debug("#_removeSession()"),yield Ue(this.storage,this.storageKey)})}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");let e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&O()&&window?.removeEventListener&&window.removeEventListener("visibilitychange",e)}catch(r){console.error("removing visibilitychange callback failed",r)}}_startAutoRefresh(){return u(this,null,function*(){yield this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");let e=setInterval(()=>this._autoRefreshTokenTick(),be);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(()=>u(this,null,function*(){yield this.initializePromise,yield this._autoRefreshTokenTick()}),0)})}_stopAutoRefresh(){return u(this,null,function*(){this._debug("#_stopAutoRefresh()");let e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)})}startAutoRefresh(){return u(this,null,function*(){this._removeVisibilityChangedCallback(),yield this._startAutoRefresh()})}stopAutoRefresh(){return u(this,null,function*(){this._removeVisibilityChangedCallback(),yield this._stopAutoRefresh()})}_autoRefreshTokenTick(){return u(this,null,function*(){this._debug("#_autoRefreshTokenTick()","begin");try{yield this._acquireLock(0,()=>u(this,null,function*(){try{let e=Date.now();try{return yield this._useSession(r=>u(this,null,function*(){let{data:{session:s}}=r;if(!s||!s.refresh_token||!s.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}let i=Math.floor((s.expires_at*1e3-e)/be);this._debug("#_autoRefreshTokenTick()",`access token expires in ${i} ticks, a tick lasts ${be}ms, refresh threshold is ${Lt} ticks`),i<=Lt&&(yield this._callRefreshToken(s.refresh_token))}))}catch(r){console.error("Auto refresh tick failed with error. This is likely a transient error.",r)}}finally{this._debug("#_autoRefreshTokenTick()","end")}}))}catch(e){if(e.isAcquireTimeout||e instanceof we)this._debug("auto refresh token tick lock not available");else throw e}})}_handleVisibilityChange(){return u(this,null,function*(){if(this._debug("#_handleVisibilityChange()"),!O()||!window?.addEventListener)return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=()=>u(this,null,function*(){return yield this._onVisibilityChanged(!1)}),window?.addEventListener("visibilitychange",this.visibilityChangedCallback),yield this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}})}_onVisibilityChanged(e){return u(this,null,function*(){let r=`#_onVisibilityChanged(${e})`;this._debug(r,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(yield this.initializePromise,yield this._acquireLock(-1,()=>u(this,null,function*(){if(document.visibilityState!=="visible"){this._debug(r,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}yield this._recoverAndRefresh()})))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()})}_getUrlForProvider(e,r,s){return u(this,null,function*(){let i=[`provider=${encodeURIComponent(r)}`];if(s?.redirectTo&&i.push(`redirect_to=${encodeURIComponent(s.redirectTo)}`),s?.scopes&&i.push(`scopes=${encodeURIComponent(s.scopes)}`),this.flowType==="pkce"){let o=M();yield U(this.storage,`${this.storageKey}-code-verifier`,o);let a=yield J(o),c=o===a?"plain":"s256";this._debug("PKCE","code verifier",`${o.substring(0,5)}...`,"code challenge",a,"method",c);let l=new URLSearchParams({code_challenge:`${encodeURIComponent(a)}`,code_challenge_method:`${encodeURIComponent(c)}`});i.push(l.toString())}if(s?.queryParams){let o=new URLSearchParams(s.queryParams);i.push(o.toString())}return s?.skipBrowserRedirect&&i.push(`skip_http_redirect=${s.skipBrowserRedirect}`),`${e}?${i.join("&")}`})}_unenroll(e){return u(this,null,function*(){try{return yield this._useSession(r=>u(this,null,function*(){var s;let{data:i,error:o}=r;return o?{data:null,error:o}:yield v(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(s=i?.session)===null||s===void 0?void 0:s.access_token})}))}catch(r){if(_(r))return{data:null,error:r};throw r}})}_enroll(e){return u(this,null,function*(){try{return yield this._useSession(r=>u(this,null,function*(){var s,i;let{data:o,error:a}=r;if(a)return{data:null,error:a};let{data:c,error:l}=yield v(this.fetch,"POST",`${this.url}/factors`,{body:{friendly_name:e.friendlyName,factor_type:e.factorType,issuer:e.issuer},headers:this.headers,jwt:(s=o?.session)===null||s===void 0?void 0:s.access_token});return l?{data:null,error:l}:(!((i=c?.totp)===null||i===void 0)&&i.qr_code&&(c.totp.qr_code=`data:image/svg+xml;utf-8,${c.totp.qr_code}`),{data:c,error:null})}))}catch(r){if(_(r))return{data:null,error:r};throw r}})}_verify(e){return u(this,null,function*(){return this._acquireLock(-1,()=>u(this,null,function*(){try{return yield this._useSession(r=>u(this,null,function*(){var s;let{data:i,error:o}=r;if(o)return{data:null,error:o};let{data:a,error:c}=yield v(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:(s=i?.session)===null||s===void 0?void 0:s.access_token});return c?{data:null,error:c}:(yield this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+a.expires_in},a)),yield this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",a),{data:a,error:c})}))}catch(r){if(_(r))return{data:null,error:r};throw r}}))})}_challenge(e){return u(this,null,function*(){return this._acquireLock(-1,()=>u(this,null,function*(){try{return yield this._useSession(r=>u(this,null,function*(){var s;let{data:i,error:o}=r;return o?{data:null,error:o}:yield v(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{headers:this.headers,jwt:(s=i?.session)===null||s===void 0?void 0:s.access_token})}))}catch(r){if(_(r))return{data:null,error:r};throw r}}))})}_challengeAndVerify(e){return u(this,null,function*(){let{data:r,error:s}=yield this._challenge({factorId:e.factorId});return s?{data:null,error:s}:yield this._verify({factorId:e.factorId,challengeId:r.id,code:e.code})})}_listFactors(){return u(this,null,function*(){let{data:{user:e},error:r}=yield this.getUser();if(r)return{data:null,error:r};let s=e?.factors||[],i=s.filter(o=>o.factor_type==="totp"&&o.status==="verified");return{data:{all:s,totp:i},error:null}})}_getAuthenticatorAssuranceLevel(){return u(this,null,function*(){return this._acquireLock(-1,()=>u(this,null,function*(){return yield this._useSession(e=>u(this,null,function*(){var r,s;let{data:{session:i},error:o}=e;if(o)return{data:null,error:o};if(!i)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};let a=this._decodeJWT(i.access_token),c=null;a.aal&&(c=a.aal);let l=c;((s=(r=i.user.factors)===null||r===void 0?void 0:r.filter(p=>p.status==="verified"))!==null&&s!==void 0?s:[]).length>0&&(l="aal2");let d=a.amr||[];return{data:{currentLevel:c,nextLevel:l,currentAuthenticationMethods:d},error:null}}))}))})}}return n.nextInstanceID=0,n})();var Be=class extends Je{constructor(t){super(t)}};var ur=function(n,t,e,r){function s(i){return i instanceof e?i:new e(function(o){o(i)})}return new(e||(e=Promise))(function(i,o){function a(h){try{l(r.next(h))}catch(d){o(d)}}function c(h){try{l(r.throw(h))}catch(d){o(d)}}function l(h){h.done?i(h.value):s(h.value).then(a,c)}l((r=r.apply(n,t||[])).next())})},dr={headers:mt},fr={schema:"public"},pr={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},gr={},ze=class{constructor(t,e,r){var s,i,o,a,c,l,h,d;if(this.supabaseUrl=t,this.supabaseKey=e,this.from=m=>this.rest.from(m),this.schema=m=>this.rest.schema(m),this.rpc=(m,k={},A)=>this.rest.rpc(m,k,A),!t)throw new Error("supabaseUrl is required.");if(!e)throw new Error("supabaseKey is required.");let p=vt(t);this.realtimeUrl=`${p}/realtime/v1`.replace(/^http/i,"ws"),this.authUrl=`${p}/auth/v1`,this.storageUrl=`${p}/storage/v1`,this.functionsUrl=`${p}/functions/v1`;let f=`sb-${new URL(this.authUrl).hostname.split(".")[0]}-auth-token`,y={db:fr,realtime:gr,auth:Object.assign(Object.assign({},pr),{storageKey:f}),global:dr},g=yt(r??{},y);this.storageKey=(i=(s=g.auth)===null||s===void 0?void 0:s.storageKey)!==null&&i!==void 0?i:"",this.headers=(a=(o=g.global)===null||o===void 0?void 0:o.headers)!==null&&a!==void 0?a:{},this.auth=this._initSupabaseAuthClient((c=g.auth)!==null&&c!==void 0?c:{},this.headers,(l=g.global)===null||l===void 0?void 0:l.fetch),this.fetch=_t(e,this._getAccessToken.bind(this),(h=g.global)===null||h===void 0?void 0:h.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers},g.realtime)),this.rest=new ce(`${p}/rest/v1`,{headers:this.headers,schema:(d=g.db)===null||d===void 0?void 0:d.schema,fetch:this.fetch}),this._listenForAuthEvents()}get functions(){return new ie(this.functionsUrl,{headers:this.headers,customFetch:this.fetch})}get storage(){return new pe(this.storageUrl,this.headers,this.fetch)}channel(t,e={config:{}}){return this.realtime.channel(t,e)}getChannels(){return this.realtime.getChannels()}removeChannel(t){return this.realtime.removeChannel(t)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var t,e;return ur(this,void 0,void 0,function*(){let{data:r}=yield this.auth.getSession();return(e=(t=r.session)===null||t===void 0?void 0:t.access_token)!==null&&e!==void 0?e:null})}_initSupabaseAuthClient({autoRefreshToken:t,persistSession:e,detectSessionInUrl:r,storage:s,storageKey:i,flowType:o,debug:a},c,l){let h={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new Be({url:this.authUrl,headers:Object.assign(Object.assign({},h),c),storageKey:i,autoRefreshToken:t,persistSession:e,detectSessionInUrl:r,storage:s,flowType:o,debug:a,fetch:l})}_initRealtimeClient(t){return new ue(this.realtimeUrl,Object.assign(Object.assign({},t),{params:Object.assign({apikey:this.supabaseKey},t?.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((e,r)=>{this._handleTokenChanged(e,"CLIENT",r?.access_token)})}_handleTokenChanged(t,e,r){(t==="TOKEN_REFRESHED"||t==="SIGNED_IN")&&this.changedAccessToken!==r?(this.realtime.setAuth(r??null),this.changedAccessToken=r):t==="SIGNED_OUT"&&(this.realtime.setAuth(this.supabaseKey),e=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}};var en=(n,t,e)=>new ze(n,t,e);var nn={production:!1,supabaseUrl:"https://bmkkolipsthwmgjsnoaj.supabase.co",supabaseKey:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJta2tvbGlwc3Rod21nanNub2FqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MDQ1MjE4MDcsImV4cCI6MjAyMDA5NzgwN30.qaX3Us8fXhZQWsAhcvTSMRRXbmUcM57dp9Ji5-Z0A5k"};export{en as a,nn as b};
